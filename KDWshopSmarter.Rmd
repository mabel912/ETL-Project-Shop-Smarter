---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.0'
      jupytext_version: 1.0.4
  kernelspec:
    display_name: Python 3
    language: python
    name: python3
---

```{python}
# import dependencies
import pandas as pd
import json
import requests
from sqlalchemy import create_engine
from config import wlm_api
from pandas.io.json import json_normalize
import time
```

```{python}
# Walmart api key from config file
apiKey = wlm_api
```

```{python}
# api Call to walmart for the product selected 20 max on 1 call
product_api = (f"http://api.walmartlabs.com/v1/items?ids=51800359,986978174,42490113,317677075,545584365,55449983,38676400,189542267,55420123,38317400,275846958,50820749,47090515,39073013,878167&apiKey={apiKey}&lsPublisherId=").format(apiKey)
```

```{python}
# request call to APU
response = requests.get(product_api)
productList = response.json()
# convert api call to DataFrame
productList = pd.DataFrame.from_dict(productList['items'], orient='columns', dtype=None)
# Grab data desired and use as column name
productList = productList[['itemId', 'name', 'salePrice', 'clearance', 'stock']]
# display the dataframe
productList
```

```{python}
# create a list of the items for api call loop
itemId = [51800359,986978174,42490113,317677075,545584365,55449983,38676400,189542267,55420123,38317400,
              275846958,50820749,47090515,39073013,878167]
items = []
# review_product_api
for item in itemId:
    url = 'http://api.walmartlabs.com/v1/reviews/' + str(item) + '?apiKey=' + str(apiKey) + '&lsPublisherId=&format=json'
    response = requests.get(url)
    prodReview = response.json()
    time.sleep(2)
#         json.dumps(response)
    items.append(prodReview)
```

```{python}
# convert api call to DataFrame
prodReview = pd.DataFrame.from_dict(items, orient='columns', dtype=None)
# Grab data desired and use as column name
prodReview = prodReview[['itemId','reviewStatistics']]
# for kwy in prodReview:
#     print(kwy)
```

```{python}
reviewStats = prodReview['reviewStatistics'].apply(pd.Series)
```

```{python}
prodRatingOver = pd.concat([prodReview, reviewStats], axis=1)
prodRatingOver = prodRatingOver[['itemId', 'averageOverallRating', 'overallRatingRange', 'totalReviewCount']]
prodRatingOver
```

```{python}
mergedDF = pd.merge(productList, prodRatingOver, on='itemId')
mergedDF
```

```{python}

```
